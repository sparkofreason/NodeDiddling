var http=require("http"),path=require("path"),fs=require("fs"),mimeTypes={".js":"text/javascript",".html":"text/html",".css":"text/css"},cache={store:{},maxSize:26214400,maxAge:54e5,cleanAfter:72e5,cleanedAt:0,clean:function(n){var t=this;n-t.cleanedAt>t.cleanedAfter&&(t.cleanedAt=n,Object.keys(t.store).forEach(function(i){n>t.store[i].timestamp+t.maxAge&&delete t.store[i]}))}};http.createServer(function(n,t){var r=path.basename(decodeURI(n.url))||"index.html",i="content/"+r;fs.exists(i,function(n){var f,u;if(n){f={"Content-type":mimeTypes[path.extname(r)]},cache[i]&&(t.writeHead(200,f),t.end(cache[i].content)),u=fs.createReadStream(i);u.once("open",function(){t.writeHead(200,f),this.pipe(t)});u.once("error",function(n){console.log(n),t.writeHead(500),t.end("Server error")});fs.stat(i,function(n,t){if(t.size<cache.maxSize){var r=0;cache[i]={content:new Buffer(t.size),timestamp:Date.now()};u.on("data",function(n){n.copy(cache[i].content,r),r+=n.length})}});return}t.writeHead(404),t.end()}),cache.clean(Date.now())}).listen(8080)