function cacheAndDeliver(n,t){fs.stat(n,function(i,r){var u=r.mtime,f=cache[n]&&u>cache[n].timestamp;if(!cache[n]||f){fs.readFile(n,function(i,r){i||(cache[n]={content:r,timestamp:Date.now()}),t(i,r)});return}console.log("loading "+n+" from cache"),t(null,cache[n].content)})}var http=require("http"),path=require("path"),fs=require("fs"),mimeTypes={".js":"text/javascript",".html":"text/html",".css":"text/css"},cache={};http.createServer(function(n,t){var i=path.basename(decodeURI(n.url))||"index.html",r="content/"+i;fs.exists(r,function(n){if(n){cacheAndDeliver(r,function(n,r){if(n){t.writeHead(500),t.end("Server error!");return}var u={"Content-type":mimeTypes[path.extname(i)]};t.writeHead(200,u),t.end(r)});return}t.writeHead(404),t.end()})}).listen(8080)